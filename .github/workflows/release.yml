#
#  //\\   OmenMon: Hardware Monitoring & Control Utility
# //  \\  Copyright © 2023 Piotr Szczepański * License: GPL3
#     //  https://omenmon.github.io/
#
# OmenMon Release Workflow
# Triggers a build and uploads artifacts as release assets

name: "OmenMon Release"
run-name: "OmenMon Release by ${{ github.actor }}"

on:
  release:
    types: [published]

permissions:
  contents: write

jobs:
  call-build:
    name: "Call Build"
    secrets: inherit
    uses: ./.github/workflows/build.yml
    with:
      version_number: ${{ github.event.release.tag_name }}
      version_word: ${{ github.event.release.prerelease && 'Preview' || 'Release' }}

  release:
    name: "Release OmenMon"
    needs: call-build
    runs-on: ubuntu-latest

    steps:
    - id: download
      name: "Download OmenMon Artifact"
      uses: actions/download-artifact@v3
      with:
        name: "OmenMon"

    - name: 'Show Download Path'
      run: echo ${{ steps.download.outputs.download-path }}

    - name: 'List Downloaded Artifacts'
      run: ls -laR ${{ steps.download.outputs.download-path }}

    - name: "Upload OmenMon Assets"
      uses: actions/upload-release-asset@v1
      with:
        upload_url: ${{ github.event.release.upload_url }}
        asset_path: ./${{ vars.RELEASE_FILE_APP }}
        asset_name: ${{ vars.RELEASE_FILE_APP }}
        asset_content_type: application/vnd.microsoft.portable-executable
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
